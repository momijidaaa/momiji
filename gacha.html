<!DOCTYPE html>
<html lang="ja"> 
<head>
  <meta charset="UTF-8">
  <title>„Ç¨„ÉÅ„É£„Ç¨„ÉÅ„É£</title>
  <style>
    body {
      font-family: "Trebuchet MS", sans-serif;
      background: linear-gradient(#f0f0f0, #dcdcdc);
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .game-container {
      width: 375px;
      height: 667px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #coinDisplay {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ffeb3b;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    #machine {
      width: 200px;
      height: 200px;
      margin-top: 50px;
    }

    .gacha-btn {
      margin-top: 20px;
      padding: 12px 30px;
      font-size: 20px;
      font-weight: bold;
      color: white;
      background: linear-gradient(45deg, #ff5722, #e91e63);
      border: none;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: transform 0.1s, opacity 0.3s;
    }

    .gacha-btn:active { transform: scale(0.95); }
    .gacha-btn.disabled { opacity: 0.5; cursor: not-allowed; }

    #result { margin-top: 15px; font-size: 18px; text-align: center; font-weight: bold; }

    .SSR { color: gold; }
    .SR  { color: purple; }
    .R   { color: blue; }
    .N   { color: gray; }

    #inventoryBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: url("images/inventory_icon.png") no-repeat center/cover;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    #overlay {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }

    #inventoryModal {
      background: white;
      padding: 20px;
      border-radius: 15px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      text-align: left;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .item-img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-right: 8px;
    }

    #inventoryModal button {
      margin-top: 10px;
      margin-right: 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #eee;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div id="coinDisplay">üí∞ 0</div>
    <img id="machine" src="images/gacha.png" alt="„Ç¨„ÉÅ„É£Êú¨‰Ωì">
    <button id="gachaBtn">Âõû„ÅôÔºÅ (10„Ç≥„Ç§„É≥)</button>
    <div id="result"></div>
    <button id="inventoryBtn"></button>
    <div id="overlay">
      <div id="inventoryModal">
        <h2>üéí „Ç§„É≥„Éô„É≥„Éà„É™</h2>
        <div id="inventoryList"></div>
        <button id="closeBtn">Èñâ„Åò„Çã</button>
        <button id="resetBtn">„É™„Çª„ÉÉ„Éà</button>
        <button id="homeBtn">üè† „Éà„ÉÉ„Éó„Å∏Êàª„Çã</button>
      </div>
    </div>
  </div>

<script src="coin.js"></script>
<script>
const items = [
  { name: "SSR: ‰ºùË™¨„ÅÆÂâ£", img: "images/densetu.png", rate: 0.01, rarity: "SSR" },
  { name: "SR: È≠îÊ≥ï„ÅÆÊùñ", img: "images/tue.png", rate: 0.09, rarity: "SR" },
  { name: "R: ÈâÑ„ÅÆÂâ£", img: "images/tetu.png", rate: 0.30, rarity: "R" },
  { name: "N: Êú®„ÅÆÊ£í", img: "images/bokutou.png", rate: 0.60, rarity: "N" },
];

let inventory = {};
let isRolling = false;

window.onload = () => {
  inventory = JSON.parse(localStorage.getItem("gacha_inventory")) || {};
  renderInventory();
  updateCoinDisplay();

  document.getElementById("gachaBtn").addEventListener("click", playGacha);
  document.getElementById("inventoryBtn").addEventListener("click", openInventory);
  document.getElementById("closeBtn").addEventListener("click", closeInventory);
  document.getElementById("resetBtn").addEventListener("click", resetInventory);
  document.getElementById("homeBtn").addEventListener("click", goHome);
};

function playGacha() {
  if (isRolling) return;
  if (!spendCoins(10)) {
    document.getElementById("result").innerText = "üí∏ „Ç≥„Ç§„É≥„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ";
    return;
  }

  updateCoinDisplay();
  isRolling = true;
  disableButton();

  const machine = document.getElementById("machine");
  machine.src = "images/gacha.gif";

  setTimeout(() => {
    const item = getRandomItem();
    if (inventory[item.name]) inventory[item.name].count++;
    else inventory[item.name] = { ...item, count: 1 };

    localStorage.setItem("gacha_inventory", JSON.stringify(inventory));

    document.getElementById("result").innerHTML = `
      <span class="${item.rarity}">
        <img class="item-img" src="${item.img}">
        ${item.name} √ó${inventory[item.name].count}
      </span>
    `;
    machine.src = "images/gacha.png";
    isRolling = false;
    enableButton();
  }, 2000);
}

function getRandomItem() {
  let rand = Math.random();
  let sum = 0;
  for (let item of items) {
    sum += item.rate;
    if (rand < sum) return item;
  }
}

function disableButton() {
  const btn = document.getElementById("gachaBtn");
  btn.classList.add("disabled");
  btn.disabled = true;
}

function enableButton() {
  const btn = document.getElementById("gachaBtn");
  btn.classList.remove("disabled");
  btn.disabled = false;
}

function openInventory() {
  document.getElementById("overlay").style.display = "flex";
  renderInventory();
}

function closeInventory() {
  document.getElementById("overlay").style.display = "none";
}

function renderInventory() {
  const list = document.getElementById("inventoryList");
  list.innerHTML = "";
  for (const key in inventory) {
    const item = inventory[key];
    list.innerHTML += `
      <div>
        <img class="item-img" src="${item.img}"> 
        ${item.name} √ó${item.count}
      </div>
    `;
  }
}

function resetInventory() {
  if (confirm("„Ç§„É≥„Éô„É≥„Éà„É™„Å®„Ç≥„Ç§„É≥„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü")) {
    inventory = {};
    saveCoins(100);
    localStorage.setItem("gacha_inventory", JSON.stringify(inventory));
    renderInventory();
    updateCoinDisplay();
  }
}

function updateCoinDisplay() {
  document.getElementById("coinDisplay").innerText = `üí∞ ${loadCoins()}`;
}

function goHome() {
  window.location.href = "index.html";
}
</script>
</body>
</html>