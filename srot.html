<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>数字スロット</title>
  <style>
    body { text-align: center; font-family: sans-serif; margin-top: 50px; }
    #slot { display: flex; justify-content: center; gap: 20px; }
    .reel-container {
      width: 60px;
      height: 60px; /* 1数字分の高さ */
      overflow: hidden;
      border: 2px solid #333;
      border-radius: 8px;
      font-size: 40px;
      background: #fff;
    }
    .reel {
      display: flex;
      flex-direction: column;
      transform: translateY(0);
      transition: transform 1s ease-out;
    }
    .digit {
      height: 60px;
      line-height: 60px;
    }
    .btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #e74c3c;
      color: white;
      cursor: pointer;
    }
    .home {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #e74c3c;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { background: #c0392b; }
  </style>
</head>

<body>
  <h1>🎰 数字スロット 🎰</h1>

  <div id="slot">
    <div class="reel-container"><div class="reel" id="r1"></div></div>
    <div class="reel-container"><div class="reel" id="r2"></div></div>
    <div class="reel-container"><div class="reel" id="r3"></div></div>
  </div>

<p id="coins">残りコイン: 0</p>
<p id="result">コインを入れてください！</p>
<button class="btn" onclick="playSlot()">▶ 回す</button>

   <button class="home" onclick="location.href='index.html'" style="margin-top:40px;">
    ← トップページへ戻る
  </button>
 <script src="coin.js"></script>
<script>
  const numbers = [0,1,2,3,4,5,6,7,8,9];

  // 各リールに数字を並べておく
  function setupReels() {
    for (let i=1; i<=3; i++) {
      const reel = document.getElementById("r"+i);
      reel.innerHTML = "";
      for (let j=0; j<30; j++) {
        const d = document.createElement("div");
        d.className = "digit";
        d.textContent = numbers[j % 10];
        reel.appendChild(d);
      }
    }
    updateCoins(); // 初期表示
  }
  setupReels();

  function updateCoins() {
    document.getElementById("coins").textContent = "残りコイン: " + loadCoins();
  }

  function playSlot() {
    // 1コイン消費
    if (!spendCoins(1)) {
      document.getElementById("result").textContent = "💰 コインが足りません！";
      return;
    }
    updateCoins();
    document.getElementById("result").textContent = "回転中…";

    for (let i=1; i<=3; i++) {
      const reel = document.getElementById("r"+i);
      const finalNumber = Math.floor(Math.random()*10);
      const offset = -( (20 + finalNumber) * 60 ); 
      setTimeout(()=>{
        reel.style.transition = "transform 1s ease-out";
        reel.style.transform = `translateY(${offset}px)`;
      }, i * 500);
    }

    setTimeout(()=>{
      const results = [];
      for (let i=1; i<=3; i++) {
        const reel = document.getElementById("r"+i);
        const matrix = getComputedStyle(reel).transform;
        const match = matrix.match(/matrix.*\((.+)\)/);
        let ty = 0;
        if (match) ty = parseFloat(match[1].split(",")[5]);
        const index = Math.abs(Math.round(ty / 60)) % 10;
        results.push(index);
      }

      if (results[0]===results[1] && results[1]===results[2]) {
        document.getElementById("result").textContent = `🎉 大当たり！ ${results.join(" ")}`;
        addCoins(10); // 当たりで10コイン追加
      } else {
        document.getElementById("result").textContent = `結果: ${results.join(" ")}`;
      }
      updateCoins();
    }, 2500);
  }
</script>

</body>
</html>
